<!doctype html>
<html xmlns:th="http://www.springframework.org/schema/mvc">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>基本地图展示</title>
    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="https://webapi.amap.com/maps?v=1.4.9&key=" + th:text="${key}"></script>
    <script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" type="text/css" href="webjars/bootstrap/3.3.7/css/bootstrap.min.css"/>
</head>
<body>

<div class="input-group">
    <input class="input-sm" id="row" placeholder="行号">
    <input class="input-sm" id="col" placeholder="列号">
    <input type="submit" class="btn-default" value="绘制" id="show" onclick="show()">
    <input type="submit" class="btn-default" value="清空元素" id="clearAll" onclick="clearAll()">
</div>
<div id="container" style="width:100%; height:600px; "></div>

<script>
    var map = new AMap.Map('container', {
        resizeEnable: true,
        zoom:6,
        center: [116.397428, 39.90923]
    });

    function clearAll() {
        map.clearMap();
    }

    function show() {
        var row = document.getElementById("row").value || "0";
        var col = document.getElementById("col").value || "0";

        var search = {};
        search["row"] = row.split(",");
        search["col"] = col.split(",");
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/search",
            data: JSON.stringify(search),
            dataType: 'json',
            cache: false,
            timeout: 600000,
            success: function (data) {
                map.clearMap();
                var total = data.total;
                if(total != null && total > 0) {
                    var pointsList = data.points;
                    for (var i = 0; i < total; i++) {
                        var points = pointsList[i];

                        var polygonArr = new Array();//多边形覆盖物节点坐标数组
                        polygonArr.push([points[0][0], points[0][1]]);
                        polygonArr.push([points[1][0], points[1][1]]);
                        polygonArr.push([points[2][0], points[2][1]]);
                        polygonArr.push([points[3][0], points[3][1]]);

                        renderPolygon(polygonArr);
                        if(i == total -1) {
                            map.panTo([points[0][0], points[0][1]]);
                        }
                    }
                }
            },
            error: function (e) {
                alert("error: " + e);
            }
        });
    }
    
    function renderPolygon(polygonArr) {
        var  polygon = new AMap.Polygon({
            path: polygonArr,//设置多边形边界路径
            strokeColor: "#FF33FF", //线颜色
            strokeOpacity: 0.2, //线透明度
            strokeWeight: 3,    //线宽
            fillColor: "#1791fc", //填充色
            fillOpacity: 0.35//填充透明度
        });
        map.add(polygon);
    }
</script>

<script type="text/javascript"
        src="webjars/jquery/2.2.4/jquery.min.js"></script>

</body>
</html>